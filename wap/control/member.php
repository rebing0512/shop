<?php/** * 用户登陆 */defined('TTShop') or exit('Access Invalid!');class memberControl extends mobileMemberControl{    public function __construct()    {        parent::__construct();    }    /*    *用户中心首页    */    public function indexOp()    {        //$referer_host = isset($_SERVER['HTTP_REFERER']) ? parse_url($_SERVER['HTTP_REFERER'],PHP_URL_HOST) : null;        if ($_GET['center'] != 'buyer' && $this->member_info['default_position'] != 0){            //Tpl::output('seller_center',urlMobile('seller_center', 'index'));            //header("Location:".urlMobile('seller_center','index'));            Tpl::setDir('seller');            Tpl::setLayout('seller_layout');            $model_order = Model('order');            $member_info = array();            $member_info = $this->getMemberAndGradeInfo(true);            $member_info['user_name'] = $this->member_info['member_name'];            $member_info['avator'] = getMemberAvatarForID($this->member_info['member_id']);            $member_info['point'] = $this->member_info['member_points'];            $member_info['predepoit'] = $this->member_info['available_predeposit'];            $member_info['available_rc_balance'] = $this->member_info['available_rc_balance'];            $member_info['level_name'] = $this->member_info['level_name'];            $member_info['order_nopay_count'] = $model_order->getOrderCountByID('buyer', $this->member_info['member_id'], 'NewCount');            $member_info['order_noreceipt_count'] = $model_order->getOrderCountByID('buyer', $this->member_info['member_id'], 'SendCount');            $member_info['order_noeval_count'] = $model_order->getOrderCountByID('buyer', $this->member_info['member_id'], 'EvalCount');            $member_info['order_wait_shipping'] = $model_order->getOrderCountByID('buyer',$this->member_info['member_id'], 'WaitShipping');            $model_browse = Model('goods_browse');            $viewed_goods = $model_browse->getViewedGoodsList($this->member_info['member_id']);            $member_info['viewed_goods_num'] = count($viewed_goods);            //获得会员升级进度            if ($this->level_name['less_exppoints'] == 0) {                $member_info['tipinfo'] = "已达到最高会员级别，继续加油保持这份荣誉哦！";            } else {                $member_info['tipinfo'] = "再累积{$this->level_name['less_exppoints']}经验值可升级{$this->level_name['upgrade_name']}";            }            $member_info['exppoints_rate'] = $this->level_name['exppoints_rate'];            $favorites_model = Model('favorites');            $member_info['favorites_store'] = $favorites_model->getStoreFavoritesCountByStoreId('', $this->member_info['member_id']);//店铺收藏数            $member_info['favorites_goods'] = $favorites_model->getGoodsFavoritesCountByGoodsId('', $this->member_info['member_id']);//商品收藏数            Tpl::output('member_info',$member_info);            $store['seller_name'] = $this->seller_info['seller_name'];            $store['store_avatar'] = getStoreLogo($this->seller_info['store_avatar']);            // 店铺等级信息            $store['grade_name'] = $this->store_grade['sg_name'];            $store['grade_goodslimit'] = $this->store_grade['sg_goods_limit'];            $store['grade_albumlimit'] = $this->store_grade['sg_album_limit'];            $store['store_id'] = $this->store_info['store_id'];            $store['store_type'] = $this->store_info['store_type'];            $store['notice'] = $this->store_info['notice'];            $store['status'] = $this->store_info['status'];            Tpl::output('store_info',$store);            Tpl::output('web_seo','我的商城');            Tpl::showpage('seller_center');            exit;        }        $model_order = Model('order');        $member_info = array();        $member_info = $this->getMemberAndGradeInfo(true);        $member_info['user_name'] = $this->member_info['member_name'];        $member_info['avator'] = getMemberAvatarForID($this->member_info['member_id']);        $member_info['point'] = $this->member_info['member_points'];        $member_info['predepoit'] = $this->member_info['available_predeposit'];        $member_info['available_rc_balance'] = $this->member_info['available_rc_balance'];        $member_info['level_name'] = $this->member_info['level_name'];        $member_info['order_nopay_count'] = $model_order->getOrderCountByID('buyer', $this->member_info['member_id'], 'NewCount');        $member_info['order_noreceipt_count'] = $model_order->getOrderCountByID('buyer', $this->member_info['member_id'], 'SendCount');        $member_info['order_noeval_count'] = $model_order->getOrderCountByID('buyer', $this->member_info['member_id'], 'EvalCount');        $member_info['order_wait_shipping'] = $model_order->getOrderCountByID('buyer',$this->member_info['member_id'], 'WaitShipping');        $model_browse = Model('goods_browse');        $viewed_goods = $model_browse->getViewedGoodsList($this->member_info['member_id']);        $member_info['viewed_goods_num'] = count($viewed_goods);        //获得会员升级进度        if ($this->level_name['less_exppoints'] == 0) {            $member_info['tipinfo'] = "已达到最高会员级别，继续加油保持这份荣誉哦！";        } else {            $member_info['tipinfo'] = "再累积{$this->level_name['less_exppoints']}经验值可升级{$this->level_name['upgrade_name']}";        }        $member_info['exppoints_rate'] = $this->level_name['exppoints_rate'];        $favorites_model = Model('favorites');        $member_info['favorites_store'] = $favorites_model->getStoreFavoritesCountByStoreId('', $this->member_info['member_id']);//店铺收藏数        $member_info['favorites_goods'] = $favorites_model->getGoodsFavoritesCountByGoodsId('', $this->member_info['member_id']);//商品收藏数        Tpl::output('member_info',$member_info);        if (!empty($this->member_info['member_id'])) {            $store_info = Model('store')->where('member_id ='.$this->member_info['member_id'])->find();            Tpl::output('store_info',$store_info);        }        Tpl::output('web_seo', '我的商城');        Tpl::showpage('member');    }    /*    *获取用户中心信息    */    public function ajax_memberOp()    {        $model_order = Model('order');        $member_info = array();        $member_info = $this->getMemberAndGradeInfo(true);        $member_info['user_name'] = $this->member_info['member_name'];        $member_info['avator'] = getMemberAvatarForID($this->member_info['member_id']);        $member_info['point'] = $this->member_info['member_points'];        $member_info['predepoit'] = $this->member_info['available_predeposit'];        $member_info['available_rc_balance'] = $this->member_info['available_rc_balance'];        $member_info['level_name'] = $this->member_info['level_name'];        $member_info['order_nopay_count'] = $model_order->getOrderCountByID('buyer', $this->member_info['member_id'], 'NewCount');        $member_info['order_noreceipt_count'] = $model_order->getOrderCountByID('buyer', $this->member_info['member_id'], 'SendCount');        $member_info['order_noeval_count'] = $model_order->getOrderCountByID('buyer', $this->member_info['member_id'], 'EvalCount');        $member_info['order_wait_shipping'] = $model_order->getOrderCountByID('buyer',$this->member_info['member_id'], 'WaitShipping');        //获得会员升级进度        if ($this->level_name['less_exppoints'] == 0) {            $member_info['tipinfo'] = "已达到最高会员级别，继续加油保持这份荣誉哦！";        } else {            $member_info['tipinfo'] = "再累积{$this->level_name['less_exppoints']}经验值可升级{$this->level_name['upgrade_name']}";        }        $member_info['exppoints_rate'] = $this->level_name['exppoints_rate'];        $favorites_model = Model('favorites');        $member_info['favorites_store'] = $favorites_model->getStoreFavoritesCountByStoreId('', $this->member_info['member_id']);//店铺收藏数        $member_info['favorites_goods'] = $favorites_model->getGoodsFavoritesCountByGoodsId('', $this->member_info['member_id']);//商品收藏数        output_data(array('member_info' => $member_info));    }}